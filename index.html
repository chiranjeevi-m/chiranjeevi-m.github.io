<!DOCTYPE html>
<html>
<head>
  <title>Walkathon Registration</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  <h2>Register for Walkathon</h2>
  <form id="regForm">
    <input type="text" name="name" placeholder="Name" required><br>
    <input type="number" name="age" placeholder="Age" required><br>
    <input type="text" name="tshirt" placeholder="T-Shirt Size" required><br>
    <input type="email" name="email" placeholder="Email" required><br>
    <input type="text" name="mobile" placeholder="Mobile" required><br>
    <input type="text" name="paymentId" placeholder="Payment Transaction ID" required><br>
    <button type="submit">Register</button>
  </form>

  <script>
    const webAppURL = 'https://script.google.com/macros/s/AKfycbyQ1Z0Pc0NsScsorAQjUOgF0hPL6Uoo1LcrY6V-DxTPHmep3-inM5cSg2906m9Dgkd1/exec'; // replace with your /exec URL
    const SECRET_KEY = 'chiranjeevi_m'; // must match Apps Script

    const form = document.getElementById('regForm');
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = {
        name: form.name.value,
        age: form.age.value,
        tshirt: form.tshirt.value,
        email: form.email.value,
        mobile: form.mobile.value,
        paymentId: form.paymentId.value,
        key: SECRET_KEY
      };

      try {
        const res = await fetch(webAppURL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });

        const text = await res.text();
        let data;
        try {
          data = JSON.parse(text);
        } catch(err) {
          Swal.fire('Error', 'Server returned invalid JSON: ' + text, 'error');
          return;
        }

        if (data.status === 'success') {
          Swal.fire('Registered!', `Registration ID: ${data.registrationId}<br>Token: ${data.token}`, 'success');
          form.reset();
        } else if (data.status === 'duplicate') {
          Swal.fire('Already Registered', `Registration ID: ${data.registrationId}<br>Token: ${data.token}`, 'warning');
        } else {
          Swal.fire('Error', data.message || 'Unknown error', 'error');
        }

      } catch(err) {
        Swal.fire('Network Error', err.message, 'error');
      }
    });
  </script>
</body>
</html>


